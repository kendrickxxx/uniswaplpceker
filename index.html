<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Uniswap V3 Position Checker</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 20px auto; }
    label { display: block; margin-top: 12px; }
    select, input { width: 100%; padding: 8px; margin-top: 4px; }
    button { margin-top: 16px; padding: 10px 16px; cursor: pointer; }
    pre { background: #111; color: #0f0; padding: 12px; margin-top: 16px; overflow-x: auto; }
  </style>
</head>
<body>
  <h2>Uniswap V3 – Position & Reward Checker</h2>

  <label>
    Chain
    <select id="chain">
      <option value="ethereum">Ethereum</option>
      <option value="arbitrum">Arbitrum</option>
      <option value="optimism">Optimism</option>
      <option value="base">Base</option>
      <option value="polygon">Polygon</option>
    </select>
  </label>

  <label>
    Token ID (NFT position id)
    <input id="tokenId" placeholder="contoh: 615022" />
  </label>

  <label>
    RPC URL (Infura / Alchemy, dll)
    <input id="rpcUrl" placeholder="https://mainnet.infura.io/v3/YOUR_KEY" />
  </label>

  <button id="checkBtn">Check Position</button>

  <pre id="result">Result akan muncul di sini…</pre>

  <!-- ethers.js -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script>
    // alamat NonfungiblePositionManager per chain
    // NOTE: isi dengan alamat dari docs resmi Uniswap untuk tiap chain
    // lihat: Deployments docs (Ethereum, Arbitrum, Optimism, Polygon, Base) 
    const NFPM_ADDRESSES = {
      ethereum: "0xC36442b4a4522E871399CD717aBDD847Ab11FE88", // mainnet
      arbitrum:  "PASTE_ARBITRUM_ADDRESS_HERE",
      optimism:  "PASTE_OPTIMISM_ADDRESS_HERE",
      base:      "PASTE_BASE_ADDRESS_HERE",
      polygon:   "PASTE_POLYGON_ADDRESS_HERE",
    };

    // ABI minimal: cuma butuh positions()
    const NFPM_ABI = [
      "function positions(uint256 tokenId) view returns (" +
      "uint96 nonce," +
      "address operator," +
      "address token0," +
      "address token1," +
      "uint24 fee," +
      "int24 tickLower," +
      "int24 tickUpper," +
      "uint128 liquidity," +
      "uint256 feeGrowthInside0LastX128," +
      "uint256 feeGrowthInside1LastX128," +
      "uint128 tokensOwed0," +
      "uint128 tokensOwed1" +
      ")"
    ];

    async function checkPosition() {
      const chain = document.getElementById("chain").value;
      const tokenId = document.getElementById("tokenId").value.trim();
      const rpcUrl = document.getElementById("rpcUrl").value.trim();
      const resultEl = document.getElementById("result");

      if (!tokenId) {
        resultEl.textContent = "Masukkan tokenId dulu.";
        return;
      }
      if (!rpcUrl) {
        resultEl.textContent = "Masukkan RPC URL dulu.";
        return;
      }

      const nfpmAddress = NFPM_ADDRESSES[chain];
      if (!nfpmAddress || nfpmAddress.startsWith("PASTE_")) {
        resultEl.textContent = "Alamat NonfungiblePositionManager untuk chain ini belum di-set.";
        return;
      }

      try {
        const provider = new ethers.providers.JsonRpcProvider(rpcUrl);
        const nfpm = new ethers.Contract(nfpmAddress, NFPM_ABI, provider);

        const pos = await nfpm.positions(tokenId);

        const liquidity = pos.liquidity; // BigNumber
        const hasLiquidity = liquidity.gt(0);
        const tokensOwed0 = pos.tokensOwed0;
        const tokensOwed1 = pos.tokensOwed1;

        const data = {
          chain,
          tokenId,
          token0: pos.token0,
          token1: pos.token1,
          feeTier: pos.fee.toString(),
          tickLower: pos.tickLower.toString(),
          tickUpper: pos.tickUpper.toString(),
          liquidity: liquidity.toString(),
          hasLiquidity,
          tokensOwed0: tokensOwed0.toString(),
          tokensOwed1: tokensOwed1.toString(),
          hasUnclaimedRewards:
            tokensOwed0.gt(0) || tokensOwed1.gt(0)
        };

        resultEl.textContent = JSON.stringify(data, null, 2);
      } catch (err) {
        console.error(err);
        resultEl.textContent = "Error: " + (err.reason || err.message || err);
      }
    }

    document
      .getElementById("checkBtn")
      .addEventListener("click", checkPosition);
  </script>
</body>
</html>
